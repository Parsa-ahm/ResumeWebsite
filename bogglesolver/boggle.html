<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Boggle Solver â€“ Parsa Ahmadizadeh</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="../styles/styles.css" />
  <link rel="stylesheet" href="../styles/games.css" />
  <script src="https://kit.fontawesome.com/2711c8f32d.js" crossorigin="anonymous"></script>
</head>

<body>
  <!-- Navbar will be loaded here dynamically -->
  <script src="../components/navbar-loader.js"></script>

  <section class="game-header">
    <div class="container">
      <div class="row">
        <div class="">
          <h1 class="">
            Boggle Solver
            <small class="text-body-secondary"> Rust </small>
          </h1>
          <p class="mt-3">
            The Boggle solver project taught me advanced algorithm design,
            data structure optimization, Rust programming, and web development
            skills. The unique challenges of efficiently solving the Boggle
            board, integrating different technologies, and creating a dynamic
            user interface contributed to my growth as a developer. The
            technical details and optimizations, particularly in handling time
            and space complexity, provided valuable insights into writing
            efficient and scalable software.
          </p>
        </div>
      </div>
    </div>
  </section>

  <main class="container game-content-section">
    <!-- Controls Card -->
    <div class="game-card">
      <div class="card-body">
        <div class="game-controls">
          <label for="board-size">Board Size:</label>
          <input type="number" id="board-size" class="form-control" value="4" min="2" max="12" style="width: 80px;" />
          <button id="generate-btn" class="btn game-btn game-btn-primary">Generate</button>
          <button id="solve-btn" class="btn game-btn game-btn-success">Solve</button>
        </div>
      </div>
    </div>

    <!-- Boggle Board Card -->
    <div class="game-board-container">
      <table id="boggle-board"></table>
    </div>

    <!-- Results Card -->
    <div class="game-results">
      <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-3">
        <h4 class="mb-0">Found Words (<span id="word-count">0</span>)</h4>
        <input id="search-box" type="text" placeholder="Search..." class="search-box" style="max-width: 300px;" />
      </div>
      <div id="results">
        <div id="word-list"></div>
      </div>
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="dictionary.js"></script>
  <script>
    let dictionary = new Set();
    let prefixes = new Set();
    let board = [];
    let lastWords = [];
    const directions = [[-1, -1], [-1, 0], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 0], [1, 1]];

    function loadDictionary() {
      // Dictionary is loaded via script tag, so DICTIONARY_WORDS should be available
      if (typeof DICTIONARY_WORDS === 'undefined') {
        console.error('Dictionary not loaded. Make sure dictionary.js is included before the script.');
        alert('Dictionary file not loaded. Please ensure dictionary.js is included in the page.');
        return;
      }
      
      // Load words into dictionary Set and prefixes Set
      DICTIONARY_WORDS.forEach(word => {
        const w = word.toLowerCase().trim();
        if (w.length >= 3) {
          dictionary.add(w);
          for (let i = 1; i <= w.length; i++) {
            prefixes.add(w.slice(0, i));
          }
        }
      });
      
      console.log('Dictionary loaded:', dictionary.size, 'words');
    }

    function generateBoard() {
      const size = parseInt(document.getElementById('board-size').value, 10);
      const tbl = document.getElementById('boggle-board'); tbl.innerHTML = '';
      board = Array.from({ length: size }, () => Array(size).fill(''));
      const alpha = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      for (let i = 0; i < size; i++) {
        const row = tbl.insertRow();
        for (let j = 0; j < size; j++) {
          const cell = row.insertCell(); cell.className = 'boggle-cell';
          const inp = document.createElement('input');
          inp.type = 'text'; inp.maxLength = 1;
          const letter = alpha[Math.floor(Math.random() * 26)];
          inp.value = letter;
          inp.oninput = () => {
            const val = inp.value.toUpperCase().slice(0, 1);
            inp.value = val;
            board[i][j] = val.toLowerCase();
          };
          board[i][j] = letter.toLowerCase();
          cell.appendChild(inp);
        }
      }
      clearResults();
    }

    function updateBoardFromInputs() {
      // Update the board array from the current input values
      const tbl = document.getElementById('boggle-board');
      const size = tbl.rows.length;
      board = Array.from({ length: size }, () => Array(size).fill(''));
      
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          const cell = tbl.rows[i].cells[j];
          const input = cell.querySelector('input');
          if (input && input.value) {
            board[i][j] = input.value.toLowerCase().trim();
          } else {
            board[i][j] = '';
          }
        }
      }
    }

    function solveBoggle() {
      // Update board from current input values before solving
      updateBoardFromInputs();
      
      const size = board.length;
      if (size === 0 || dictionary.size === 0) {
        console.error('Board is empty or dictionary not loaded');
        alert('Please generate a board first and ensure the dictionary is loaded.');
        return;
      }

      const visited = Array.from({ length: size }, () => Array(size).fill(false));
      const found = new Set();
      
      function dfs(x, y, path) {
        if (x < 0 || y < 0 || x >= size || y >= size) return;
        if (visited[x][y]) return;
        if (!board[x][y]) return; // Skip empty cells
        
        const word = path + board[x][y].toLowerCase();
        if (!prefixes.has(word)) return;
        if (word.length >= 3 && dictionary.has(word)) {
          found.add(word);
        }
        visited[x][y] = true;
        for (let [dx, dy] of directions) {
          dfs(x + dx, y + dy, word);
        }
        visited[x][y] = false;
      }
      
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (board[i][j]) {
            dfs(i, j, '');
          }
        }
      }
      
      lastWords = Array.from(found).sort((a, b) => b.length - a.length || a.localeCompare(b));
      displayResults(lastWords);
    }

    function clearResults() {
      lastWords = [];
      displayResults([]);
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadDictionary();
      generateBoard();
      document.getElementById('generate-btn').onclick = generateBoard;
      document.getElementById('solve-btn').onclick = solveBoggle;
      document.getElementById('search-box').oninput = () => {
        const q = document.getElementById('search-box').value.toLowerCase();
        const filtered = lastWords.filter(w => w.includes(q));
        displayResults(filtered);
      };
    });

    function displayResults(words) {
      document.getElementById('word-count').textContent = words.length;
      const container = document.getElementById('word-list');
      container.innerHTML = '';
      const groups = {};
      words.forEach(w => {
        const letter = w[0].toUpperCase();
        if (!groups[letter]) groups[letter] = [];
        groups[letter].push(w);
      });
      Object.keys(groups).sort().forEach(letter => {
        const wrapper = document.createElement('div'); wrapper.className = 'word-group';
        const h = document.createElement('h5'); h.textContent = letter;
        wrapper.appendChild(h);
        const ul = document.createElement('ul'); ul.className = 'list-group';
        groups[letter].forEach(w => {
          const li = document.createElement('li');
          li.className = 'list-group-item word-item';
          li.textContent = w;
          ul.appendChild(li);
        });
        wrapper.appendChild(ul);
        container.appendChild(wrapper);
      });
    }
  </script>
</body>

</html>